================================================================================
PROMPT COMPLETO: QBO Feature Validation para Projeto TCO
================================================================================

Data: 2025-12-03
Projeto: TCO (Traction Control Outfitters)
Company: Apex Tire

================================================================================
1. CONTEXTO DO PROJETO
================================================================================

Objetivo: Validar features do QBO Fall Release para a Intuit, gerando evidencias (screenshots) e planilha de controle.

Processo geral:
• Logar no QuickBooks Online (QBO)
• Entrar na company correta (Apex Tire ou Consolidated View)
• Navegar ate cada feature definida no catalogo
• Tirar screenshot da tela correta, sem anotacoes
• Gerar planilha Excel com notas e hyperlinks para os arquivos de evidencia

================================================================================
2. LISTA DE FEATURES A VALIDAR
================================================================================

As features vem da Coluna A do catalogo canonico TCO.

• Cada linha representa um item de validacao independente.
• O nome da feature pode se repetir em linhas diferentes, isso e esperado.
• O campo Ref e o identificador unico usado em planilha, codigo e screenshots.

FUSION / IES UI
• Fusion UI Updates for IES

DIMENSIONS
• Dimensions: Dimension Assignment

DTM Digital Transaction Management
• DTM: Invoicing and Vendor Updates for QB Desktop Parity  (Multiple Shipping Addresses)
• DTM: Customer Updates for QB Desktop Parity  (Contacts e CC BCC em vendor record)
• DTM: Invoicing and Vendor Updates for QB Desktop Parity  (Vendor Notes)

BI Business Intelligence
• BI: KPIs (from 3P Apps)
• BI: KPIs (from custom formulas)
• BI: Dashboards
• BI: Advanced Reporting (Visual customization and Custom formula)
• BI: Advanced Reporting (Global Report Settings)
• BI: Advanced Reporting (New Management Reports)

CONSTRUCTION
• Construction: Project Phases v2
• Construction: Cost Groups
• Construction: Budgets v3
• Construction: AIA Billing
• Construction: Certified Payroll Report

BILL PAY
• Bill Pay: Payment Release Approval Workflow
• Bill Pay: Instant Payments

WFS Workforce Solutions
• WFS: W2 Scalability
• WFS: Run Payroll Processing Improvements
• WFS: Paycheck Corrections Improvements

AI AGENTS
• AI Agents: Accounting Agent
• AI Agents: Payment Agent
• AI Agents: Customer Agent
• AI Agents: Payroll Agent
• AI Agents: Project Management Agent
• AI Agents: Finance Agent
• AI Agents: Solutions Agent (setup and customization capabilities)
• AI Agents: Sales Tax Agent

================================================================================
3. FLUXO DE VALIDACAO
================================================================================

ETAPA 1: LOGIN

• Conectar ao Chrome via Playwright CDP na porta 9222.
• Usar credenciais do projeto TCO.
• Confirmar que entrou na company correta, Apex Tire ou Consolidated View.
• Conferir no topo da tela se aparece o nome correto da company.
• Se ainda estiver na tela de selecao de empresa ou “Restore your company”, selecionar manualmente antes de continuar.

Checklist de login:
• Chrome aberto
• Pagina principal carregada
• Company correta selecionada
• Nao estar na tela de selecao de empresa

ETAPA 2: PARA CADA FEATURE

Para cada linha do catalogo TCO:

• Usar a view correta para aquela feature Company View ou Consolidated View.
• Navegar ate a rota correspondente, conforme secao 7.
• Aguardar de dois a tres segundos apos o carregamento.
• Confirmar que a tela corresponde a feature em validacao:
  • Titulo, menus, colunas e elementos chaves precisam bater com o contexto da feature.
  • Se aparecer seletor de empresa ou pagina de erro, corrigir antes de tirar o screenshot.
• Tirar screenshot sem anotacoes.
• Salvar o arquivo na pasta de evidencias do Google Drive.

ETAPA 3: APOS CAPTURA

• Aguardar sincronizacao do Google Drive.
• Obter os hyperlinks dos arquivos pelo FILE ID.
• Atualizar a planilha Excel com uma linha por feature do catalogo.

================================================================================
4. ESTRUTURA DA PLANILHA
================================================================================

Colunas obrigatorias:

• Ref: codigo unico da feature, por exemplo TCO 017
• Project: TCO
• Company: Apex Tire ou Consolidated View, conforme usado na evidencia
• Feature: nome da feature exatamente como na lista da secao 2
• Status: YES, NO, PARTIAL ou Testing
• Intuit_notes: notas para Intuit
• Internal_TBX_notes: notas internas TestBox
• Evidence_file: nome do arquivo de screenshot exclusivo daquela feature
• Link: hyperlink para o arquivo no Google Drive

Regras de identidade:

• Cada linha da planilha representa exatamente uma linha do catalogo TCO.
• A coluna Ref e o identificador unico e principal de cada item.
• O mesmo nome em Feature pode aparecer em mais de uma linha, isso nao significa duplicata nem erro.
• Toda logica de codigo deve usar Ref como chave principal para nomear arquivos de evidencia, gerar hyperlinks e controlar status.

Evidence_file:

• Evidence_file deve ser derivado diretamente de Ref.
• Nao reaproveitar o mesmo Evidence_file para dois Refs diferentes.
• Dois itens com o mesmo texto em Feature, mas Ref diferente, precisam ter arquivos de evidencia diferentes.

================================================================================
5. STATUS E SIGNIFICADOS
================================================================================

YES: feature funciona cem por cento como esperado.
NO: feature nao aparece ou esta quebrada, mesmo com dados e flags esperadas.
PARTIAL: TestBox entregou dados e configuracoes, mas Intuit nao ativou a feature flag ou parte da logica.
Testing: ainda em processo de validacao para aquela feature.

Sobre PARTIAL:

• Nao e falha da TestBox.
• Preparacao e dados estao corretos.
• O recurso depende de ativacao da Intuit.
• A evidencia deve mostrar claramente que a preparacao foi feita.

================================================================================
6. VIEWS DO QBO
================================================================================

Consolidated View:

• Usada para features Multi Entity.
• URL base: https://qbo.intuit.com/app/homepage
• Dropdown em “Vista consolidada”.

Company View Apex Tire:

• Usada para a maioria das features.
• URL base: https://qbo.intuit.com/app/homepage
• Verificar se Apex Tire esta no cabecalho.

Regra simples:

• Se a feature nao for explicitamente Multi Entity, usar Apex Tire em Company View.

================================================================================
7. ROTAS DAS FEATURES
================================================================================

Fusion UI Updates for IES:

• Abrir a home em https://qbo.intuit.com/app/homepage com a IES carregada.
• Evidencia esperada: tela inicial mostrando claramente a left nav no layout Fusion.

Dimensions:

• Rota principal: /app/settings?settingsPanel=dimensions

DTM:

• DTM: Invoicing and Vendor Updates for QB Desktop Parity  Multiple Shipping Addresses
  Navegacao: Sales → Customers → abrir um customer → editar enderecos de envio → adicionar novos ship to.

• DTM: Customer Updates for QB Desktop Parity  Contacts e CC BCC em vendor
  Navegacao: Expenses → Vendors → abrir um vendor → editar a secao de contato, verificando campos de email e, se habilitado, CC e BCC.

• DTM: Invoicing and Vendor Updates for QB Desktop Parity  Vendor Notes
  Navegacao: Expenses → Vendors → abrir um vendor → aba ou secao de Notes, com lista de notas e comentarios.

BI:

• BI: KPIs from 3P Apps e KPIs from custom formulas: /app/business-intelligence/kpi-scorecard
• BI: Dashboards: /app/business-intelligence/dashboards
• BI: Advanced Reporting Visual customization and Custom formula: /app/reportlist
• BI: Advanced Reporting Global Report Settings: /app/reportsettings
• BI: Advanced Reporting New Management Reports: /app/managementreports

Construction:

• Project Phases v2 e Cost Groups: /app/projects
• Budgets v3: /app/budgets
• AIA Billing: fluxo a partir de projetos e faturamento de construção, tipicamente via /app/projects
• Certified Payroll Report: /app/payroll ou Reports → Certified Payroll Report

Bill Pay:

• Rota principal: /app/billpay

WFS:

• Rota principal: /app/payroll

AI Agents:

• Intuit Assist e os agentes: /app/homepage, usando o bot no canto inferior direito.

Regra geral:

• Se a rota nao existir ou redirecionar para erro, registrar em Internal_TBX_notes e ajustar Status de acordo, sem tentar caminhos aleatorios.

================================================================================
8. ESTRUTURA DE NOTAS
================================================================================

Intuit_notes:

Proposito: comunicar resultado e contexto para a Intuit.

Conteudo esperado:
• O que a feature faz, em linguagem de negocio.
• O que aparece na tela, focando na evidencia visual.
• Como o usuario interage, se for relevante.
• Resultado final YES, NO, PARTIAL ou Testing, com uma frase de justificativa.

Exemplo:

“Vendor Notes permite adicionar notas internas aos registros de fornecedores. As notas ficam visiveis no perfil do fornecedor, em uma aba dedicada, com historico e opcao de destacar notas importantes. A experiencia da tela corresponde ao comportamento mostrado no video da release.”

Internal_TBX_notes:

Proposito: documentacao interna da TestBox.

Conteudo esperado:
• Passo a passo de navegacao ate a feature.
• Problemas encontrados durante a validacao.
• Workarounds aplicados.
• Aprendizados para proximas validacoes.
• Se a tela inicial estava errada por exemplo tela de selecao de empresa, documentar como foi corrigido.

================================================================================
9. ESTRUTURA DE ARQUIVOS DO PROJETO
================================================================================

intuit-boom/
|
+-- qbo_checker/
|   +-- config.py           configuracoes EVIDENCE_DIR e credenciais
|   +-- login.py            conexao CDP e login QBO
|   +-- navigator.py        navegacao entre views e features
|   +-- screenshot.py       captura de screenshots
|   +-- spreadsheet.py      geracao de planilha Excel
|   +-- hyperlink_cache.py  cache de links do Google Drive
|   +-- features_rich.json  definicao rica das features
|
+-- data/
|   +-- hyperlink_cache.json     cache filename para Drive URL
|   +-- knowledge_extracted.json conhecimento extraido
|
+-- docs/
|   +-- MACRO_FEATURE_VALIDATION.md
|   +-- QBO_FEATURE_VALIDATION_PROMPT.txt este arquivo
|   +-- plans/
|       +-- 2025-12-03-feature-validation-design.md
|
+-- G:\Meu Drive\TestBox\QBO-Evidence\   screenshots salvos aqui

================================================================================
10. CODIGO PRINCIPAL
================================================================================

LOGIN:

```python
from qbo_checker.login import ensure_logged_in

pw, browser, page = ensure_logged_in("TCO")

# apos o login, confirmar que a company ativa e Apex Tire para features de company view,
# ou a vista consolidada correta para features multi entity
```

SCREENSHOT:

```python
from qbo_checker.screenshot import generate_filename, capture_screenshot

# ref = codigo unico da linha, por exemplo "TCO_017"
# feature_name = texto da feature, por exemplo "DTM: Invoicing and Vendor Updates for QB Desktop Parity"

filename = generate_filename(ref, "TCO", "ApexTire", feature_name)
# Exemplo de formato: 2025_12_03_TCO_ApexTire_TCO_017_DTM_InvoiceVendor.png

filepath = capture_screenshot(page, filename)
# Sempre salva em EVIDENCE_DIR (Google Drive)
```

Regras de filename:

• Sempre incluir Ref como parte do nome do arquivo.
• Nao usar apenas o texto da feature para compor o filename.
• Se Ref for TCO_017 e TCO_018, os arquivos precisam ser diferentes mesmo com nome de feature igual.

NAVEGACAO:

```python
page.goto(f"https://qbo.intuit.com{route}", timeout=30000)
time.sleep(3)

# depois do goto, sempre validar:
#   1) company no header
#   2) que a tela corresponde a feature antes de capturar o screenshot
```

================================================================================
11. O QUE NAO USAR
================================================================================

• annotate_screenshot(): nao usar
• get_element_bbox(): nao usar
• highlight ou text_target: nao usar

Os screenshots devem ser sempre limpos, sem marcacoes.

================================================================================
12. PROBLEMAS CONHECIDOS E SOLUCOES
================================================================================

Problema 1: tela de selecao de empresa

• Sintoma: screenshot mostra “Restore your company” com lista de companies.
• Causa: login nao completou, company nao foi selecionada.
• Solucao: clicar na company desejada antes de navegar para qualquer feature e repetir o processo.

Problema 2: sincronizacao do Google Drive

• Sintoma: hyperlinks nao funcionam ou arquivo nao encontrado.
• Causa: arquivos ainda nao sincronizaram ou FILE ID ainda nao esta disponivel.
• Solucao: aguardar alguns minutos e ler novamente a lista de arquivos do Drive antes de montar a planilha.

Problema 3: view incorreta

• Sintoma: feature nao aparece ou mostra erro de acesso.
• Causa: feature so funciona em Consolidated View ou em Company View.
• Solucao: verificar view correta conforme secao 6 e ajustar company view antes de tirar o screenshot.

Problema 4: timeout na navegacao

• Sintoma: erro de timeout ao carregar pagina.
• Causa: pagina lenta ou rota incorreta.
• Solucao: aumentar timeout se necessario e verificar rota na secao 7.

Problema 5: screenshot errado ou repetido

• Sintoma: varias features apontam para o mesmo arquivo, ou o print nao bate com a descricao da feature.
• Causa: reutilizacao de screenshot ou falta de checagem da tela antes do print.
• Solucao:
  • Forcar um screenshot novo para cada feature.
  • Conferir nome da feature e elementos chave na tela antes de capturar.
  • Garantir que Evidence_file seja unico e relacionado ao Ref da linha.

================================================================================
13. PRINCIPIO FUNDAMENTAL
================================================================================

O CODIGO E A FONTE DE VERDADE.

• A planilha Excel e output, nao input.
• Mudancas devem ser feitas no codigo e no JSON de features.
• A planilha e sempre gerada a partir do codigo.
• O catalogo canonico features_rich.json e a referencia final.
• Nunca deduplicar features pelo nome; trabalhar sempre por Ref.

Fluxo de atualizacao:

Conversas e aprendizados
→ Codigo features_rich.json e spreadsheet.py
→ Planilha gerada

================================================================================
14. CHECKLIST DE VALIDACAO
================================================================================

Antes de comecar:

• Chrome aberto e logado no QBO.
• Company correta selecionada Apex Tire ou Consolidated, conforme feature.
• Pasta QBO-Evidence pronta e acessivel.

Para cada feature:

• Company e view corretas para aquela feature.
• Navegou ate a tela correta, conferindo titulo e elementos chave.
• Tela nao e seletor de empresa nem erro generico.
• Screenshot tirado com nome exclusivo derivado de Ref.
• Arquivo salvo no Google Drive.

Apos todas as features:

• Aguardou sincronizacao do Drive.
• Hyperlinks gerados e testados.
• Planilha criada com uma linha por feature e Evidence_file unico.
• Intuit_notes e Internal_TBX_notes preenchidas.
• Status definido de forma coerente com a evidencia.

================================================================================
15. CONHECIMENTO POR CATEGORIA
================================================================================

DIMENSIONS:

• Permite criar campos customizados para transacoes.
• Usado para reporting avancado.
• Navegacao: Settings → Custom Fields → Dimensions.

DTM:

• Multiple Shipping Addresses: multiplos enderecos de envio por cliente.
• Vendor CC BCC: campos adicionais de email em vendors, se habilitados.
• Vendor Notes: notas internas com comentarios encadeados e favoritos.

BI:

• KPIs Library: biblioteca de indicadores pre definidos.
• Custom formulas: criacao de KPIs customizados.
• Dashboards: paineis visuais com metricas chave.
• Advanced Reporting: relatorios complexos com filtros, formulas e visual customizavel.
• Management Reports: pacotes gerenciais com capa, sumario executivo, KPIs e demonstracoes.

CONSTRUCTION:

• Project Phases: fases de projeto atravessando estimativas, despesas e budgets.
• Cost Groups: agrupamento de custos por item.
• Budgets v3: nova experiencia de orcamentos com impressao e download.
• AIA Billing: faturamento em estilo AIA, sujeito a feature flag.
• Certified Payroll: relatorio de folha no formato WH 347.

BILL PAY:

• Approval Workflow: fluxo de aprovacao para pagamentos de bills.
• Instant Payments: pagamentos instantaneos condicionados a conta bancaria ligada e verificada.

WFS:

• W2 Scalability: melhoria de performance para grande volume de documentos W2.
• Run Payroll Improvements: melhoria de performance no processamento da folha.
• Paycheck Corrections: consolidacao de tickets de correcao em um unico caso.

AI AGENTS:

• Accounting, Payment, Customer, Payroll, Project Management, Finance, Solutions e Sales Tax Agents: agentes especializados por dominio.
• Intuit Assist como entry point no canto inferior direito da home.

================================================================================
FIM DO DOCUMENTO
================================================================================

Documento criado em: 2025-12-03
Projeto: intuit-boom
Uso: prompt canonico para validacao de features QBO em TCO, podendo ser adaptado para outros tenants como Construction, Keystone, Manufacturing etc.
